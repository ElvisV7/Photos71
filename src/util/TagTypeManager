package util;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import view.CustomWarningController;
import javafx.fxml.FXMLLoader;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.stage.Stage;
import javafx.stage.Modality;
import java.io.IOException;


/**
 * A utility class that allows users to add new tag types
 * tag types check is case sensitive.
 * @author Tyler Gehringer
 */

public class TagTypeManager implements Serializable{
	private static final long serialVersionUID = 1L;
	private Map<String, Boolean> allowedTagTypes;
	
	public TagTypeManager() {
		allowedTagTypes = new HashMap<>();
		
		allowedTagTypes.put("location", false);
		allowedTagTypes.put("person", true);
	}
	
	
	
	public boolean isMultipleAllowed(String tagType) {
		
		return allowedTagTypes.getOrDefault(tagType.toLowerCase(), true);
	}
	
	public void addTagType(String tagType, boolean isMultiAllowed) {
		String key = tagType.toLowerCase();
		if (allowedTagTypes.containsKey(key)) {
			 try {
		           FXMLLoader loader = new FXMLLoader(getClass().getResource("/view/customWarning.fxml"));
		           Parent root = loader.load();
		           CustomWarningController controller = loader.getController();
		           controller.setWarning("Tag Exists", "Tag type '" + tagType + "' already exists.");
		           Stage stage = new Stage();
		           stage.setScene(new Scene(root));
		           stage.initModality(Modality.APPLICATION_MODAL);
		           stage.setTitle("Warning");
		           stage.showAndWait();
		       } catch (IOException e) {
		       }
		   } else {
		       allowedTagTypes.put(key, isMultiAllowed);
		       try {
		           FXMLLoader loader = new FXMLLoader(getClass().getResource("/view/customWarning.fxml"));
		           Parent root = loader.load();
		           CustomWarningController controller = loader.getController();
		           controller.setWarning("Tag Added", "Tag type '" + tagType + "' added. Multiple allowed: " + isMultiAllowed);
		           Stage stage = new Stage();
		           stage.setScene(new Scene(root));
		           stage.initModality(Modality.APPLICATION_MODAL);
		           stage.setTitle("Info");
		           stage.showAndWait();
		       } catch (IOException e) {
		       }
			persistTagTypes();
		}
	}
	
	public Map<String, Boolean> getAllowedTagTypes() {
        return allowedTagTypes;
	}
	
	private void persistTagTypes() {
        TagTypeManagerPersist.persist(this);
    }
    

    public static TagTypeManager loadTagTypes() {
        TagTypeManager ttm = TagTypeManagerPersist.load();
        if (ttm == null) { 
            ttm = new TagTypeManager();
        }
        return ttm;
    }
	
	
	
}
